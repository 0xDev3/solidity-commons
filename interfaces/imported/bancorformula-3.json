{
  "schema": "../schema.json",
  "tags": [],
  "name": "BancorFormula",
  "description": "",
  "eventDecorators": [],
  "functionDecorators": [
    {
      "signature": "balancedWeights(uint256,uint256,uint256,uint256,uint256)",
      "name": "balancedWeights",
      "description": "The arbitrage incentive is to convert to the point where the on-chain price is equal to the off-chain price. We want this operation to also impact the primary reserve balance becoming equal to the primary reserve staked balance. In other words, we want the arbitrager to convert the difference between the reserve balance and the reserve staked balance. Formula input: - let t denote the primary reserve token staked balance - let s denote the primary reserve token balance - let r denote the secondary reserve token balance - let q denote the numerator of the rate between the tokens - let p denote the denominator of the rate between the tokens Where p primary tokens are equal to q secondary tokens Formula output: - compute x = W(t / r * q / p * log(s / t)) / log(s / t) - return x / (1 + x) as the weight of the primary reserve token - return 1 / (1 + x) as the weight of the secondary reserve token Where W is the Lambert W Function If the rate-provider provides the rates for a common unit, for example: - P = 2 ==> 2 primary reserve tokens = 1 ether - Q = 3 ==> 3 secondary reserve tokens = 1 ether Then you can simply use p = P and q = Q If the rate-provider provides the rates for a single unit, for example: - P = 2 ==> 1 primary reserve token = 2 ethers - Q = 3 ==> 1 secondary reserve token = 3 ethers Then you can simply use p = Q and q = P.",
      "parameterDecorators": [
        {
          "name": "_primaryReserveStakedBalance",
          "description": "the primary reserve token staked balance.",
          "recommendedTypes": []
        },
        {
          "name": "_primaryReserveBalance",
          "description": "the primary reserve token balance.",
          "recommendedTypes": []
        },
        {
          "name": "_secondaryReserveBalance",
          "description": "the secondary reserve token balance.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveRateNumerator",
          "description": "the numerator of the rate between the tokens.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveRateDenominator",
          "description": "the denominator of the rate between the tokens Note that `numerator / denominator` should represent the amount of secondary tokens equal to one primary token.",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint32"
        },
        {
          "name": "param1",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint32"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "calculateCrossConnectorReturn(uint256,uint32,uint256,uint32,uint256)",
      "name": "calculateCrossConnectorReturn",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_sourceReserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_sourceReserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_targetReserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_targetReserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "calculateCrossReserveReturn(uint256,uint32,uint256,uint32,uint256)",
      "name": "calculateCrossReserveReturn",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_sourceReserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_sourceReserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_targetReserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_targetReserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "calculateFundCost(uint256,uint256,uint32,uint256)",
      "name": "calculateFundCost",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveRatio",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "calculateLiquidateReturn(uint256,uint256,uint32,uint256)",
      "name": "calculateLiquidateReturn",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveRatio",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "calculatePurchaseReturn(uint256,uint256,uint32,uint256)",
      "name": "calculatePurchaseReturn",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "calculateSaleReturn(uint256,uint256,uint32,uint256)",
      "name": "calculateSaleReturn",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "crossReserveRate(uint256,uint32,uint256,uint32,uint256)",
      "name": "crossReserveRate",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_sourceReserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_sourceReserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_targetReserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_targetReserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "crossReserveTargetAmount(uint256,uint32,uint256,uint32,uint256)",
      "name": "crossReserveTargetAmount",
      "description": "given two reserve balances/weights and a sell amount (in the first reserve token), calculates the target amount for a conversion from the source reserve token to the target reserve token Formula: return = _targetReserveBalance * (1 - (_sourceReserveBalance / (_sourceReserveBalance + _amount)) ^ (_sourceReserveWeight / _targetReserveWeight)).",
      "parameterDecorators": [
        {
          "name": "_sourceReserveBalance",
          "description": "source reserve balance.",
          "recommendedTypes": []
        },
        {
          "name": "_sourceReserveWeight",
          "description": "source reserve weight, represented in ppm (1-1000000).",
          "recommendedTypes": []
        },
        {
          "name": "_targetReserveBalance",
          "description": "target reserve balance.",
          "recommendedTypes": []
        },
        {
          "name": "_targetReserveWeight",
          "description": "target reserve weight, represented in ppm (1-1000000).",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "source reserve amount.",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "_0",
          "description": "target reserve amount.",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "fundCost(uint256,uint256,uint32,uint256)",
      "name": "fundCost",
      "description": "given a pool token supply, reserve balance, reserve ratio and an amount of requested pool tokens, calculates the amount of reserve tokens required for purchasing the given amount of pool tokens Formula: return = _reserveBalance * (((_supply + _amount) / _supply) ^ (MAX_WEIGHT / _reserveRatio) - 1).",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "pool token supply.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "reserve balance.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveRatio",
          "description": "reserve ratio, represented in ppm (2-2000000).",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "requested amount of pool tokens.",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "_0",
          "description": "reserve token amount.",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "fundSupplyAmount(uint256,uint256,uint32,uint256)",
      "name": "fundSupplyAmount",
      "description": "given a pool token supply, reserve balance, reserve ratio and an amount of reserve tokens to fund with, calculates the amount of pool tokens received for purchasing with the given amount of reserve tokens Formula: return = _supply * ((_amount / _reserveBalance + 1) ^ (_reserveRatio / MAX_WEIGHT) - 1).",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "pool token supply.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "reserve balance.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveRatio",
          "description": "reserve ratio, represented in ppm (2-2000000).",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "amount of reserve tokens to fund with.",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "_0",
          "description": "pool token amount.",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "init()",
      "name": "init",
      "description": "should be executed after construction (too large for the constructor).",
      "parameterDecorators": [],
      "returnDecorators": [],
      "emittableEvents": [],
      "readOnly": false
    },
    {
      "signature": "liquidateRate(uint256,uint256,uint32,uint256)",
      "name": "liquidateRate",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveRatio",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "liquidateReserveAmount(uint256,uint256,uint32,uint256)",
      "name": "liquidateReserveAmount",
      "description": "given a pool token supply, reserve balance, reserve ratio and an amount of pool tokens to liquidate, calculates the amount of reserve tokens received for selling the given amount of pool tokens Formula: return = _reserveBalance * (1 - ((_supply - _amount) / _supply) ^ (MAX_WEIGHT / _reserveRatio)).",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "pool token supply.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "reserve balance.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveRatio",
          "description": "reserve ratio, represented in ppm (2-2000000).",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "amount of pool tokens to liquidate.",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "_0",
          "description": "reserve token amount.",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "purchaseRate(uint256,uint256,uint32,uint256)",
      "name": "purchaseRate",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "purchaseTargetAmount(uint256,uint256,uint32,uint256)",
      "name": "purchaseTargetAmount",
      "description": "given a token supply, reserve balance, weight and a deposit amount (in the reserve token), calculates the target amount for a given conversion (in the main token) Formula: return = _supply * ((1 + _amount / _reserveBalance) ^ (_reserveWeight / 1000000) - 1).",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "liquid token supply.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "reserve balance.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveWeight",
          "description": "reserve weight, represented in ppm (1-1000000).",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "amount of reserve tokens to get the target amount for.",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "_0",
          "description": "target.",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "saleRate(uint256,uint256,uint32,uint256)",
      "name": "saleRate",
      "description": "deprecated, backward compatibility.",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_reserveWeight",
          "description": "",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "param0",
          "description": "",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    },
    {
      "signature": "saleTargetAmount(uint256,uint256,uint32,uint256)",
      "name": "saleTargetAmount",
      "description": "given a token supply, reserve balance, weight and a sell amount (in the main token), calculates the target amount for a given conversion (in the reserve token) Formula: return = _reserveBalance * (1 - (1 - _amount / _supply) ^ (1000000 / _reserveWeight)).",
      "parameterDecorators": [
        {
          "name": "_supply",
          "description": "liquid token supply.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveBalance",
          "description": "reserve balance.",
          "recommendedTypes": []
        },
        {
          "name": "_reserveWeight",
          "description": "reserve weight, represented in ppm (1-1000000).",
          "recommendedTypes": []
        },
        {
          "name": "_amount",
          "description": "amount of liquid tokens to get the target amount for.",
          "recommendedTypes": []
        }
      ],
      "returnDecorators": [
        {
          "name": "_0",
          "description": "reserve token amount.",
          "recommendedTypes": [],
          "solidityType": "uint256"
        }
      ],
      "emittableEvents": [],
      "readOnly": true
    }
  ]
}